.\" Copyright (c) 2017
.\"		Netflix Inc.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\" $FreeBSD$
.\"
.Dd Oct 17, 2017
.Dt read_bbrlog 1
.Os
.Sh NAME
.Nm read_bbrlog
.Nd Decode the logging data generated by BBR to the tcp logger
.Sh SYNOPSIS
.Nm
.Op Fl FlOenrtU?
.Op Fl d Ar directory_where_logs_are
.Op Fl i Ar input-base-name-of-log
.Op Fl o Ar output-file
.Op Fl N Ar number
.Sh DESCRIPTION
The
.Nm
utility is designed to read data generated by BBR and
placed into the black box. It by default will read from the
black box logging directory and process record files in
sucession for the selected flow. It generates a textual file
that describes the events and processes that BBR went through
during processing of a connection.
.Pp
The options are as follows:
.Bl -tag -width indent
.It Fl d
Do not use the default tcplog_dumper's
.Va output-directory
instead read files from the directory specified.
.It Fl i
The input name of the file series that you wish
the program to examine. You must include this
option and it should be the base name of a series
of files in the form
.Va input-file.
N.pcapng.xz. Note that the program will also read
non xz'd files as well. There must be a .0. file in
order for the program to function otherwise it will
not see any files.
.It Fl o
Dump output to the file
.Va output-file.
If you do not specify a file, then the output is
dumped to standard out. You may want to include this
option since the output can be quite large.
.It Fl N
Will include the flow number given in all output lines as specified. This
can be used when later sorting and merging multiple flow files to be
able to tell what flow a given line is from.
.It Fl e
include extra data, normally the utility tries to only
print one line of output per record, but with this flag some
records will display multiple lines.
.It Fl F
Display file names as you process. With this option
a line starting with a # symbol will be output as
each file is opened.
.It Fl l
Condense state change logging. During processing do
not display state changes if the pacing gain does
not change i.e. during the 6 steps of no-gain in
PROBE_BW don't display the state change. The default
for this is to display the state changes.
.It Fl O
Show less output, with this option the program will not
output every processing message but reduce its output
to a minimum. 
.It Fl t
Print out the seconds.useconds value of time in the output as well.
.It Fl r
Display time as a relative thing based on the beginning
of the flow.
.It Fl U
Include user send events, the program by default does
not show you when a user sends. Since it is not a BBR
message (and comes from the base stack) no BBR information
is carried with a user send. If you wish to see these include
this option.
.It Fl ?
Display a help message.
.El
.Pp
All flags with the exception of the -i option are optional. It
is strongly advised that you use the -o option to redirect output
or use the shell to redirect it, since the output tends to
be long.
.Sh SEE ALSO
.Xr tcplog_dumper 1
.Sh BUGS
The program currently will not read a session that is not starting
at file 0. And it terminates processing when it lacks the next
file number in sequence. So for example if you had file.0.pcapng,
file.1.pcapng, file.3.pcapng the program would not read past
file.1.pcapng. If you are missing file.0.pcapng then the program
would output nothing.
.Pp
In the future a -f option should probably be added to force a
specific file and specify the full file name.
